# i18n Internationalization Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Add bilingual support (Traditional Chinese / English) to Movie Picker with react-i18next

**Architecture:** Three-layer architecture - i18next for translation logic, Zustand store for state management, React components consuming translations via hooks. Language preference persisted in localStorage. TMDB API requests include language parameter, triggering refetch via React Query when language changes.

**Tech Stack:** react-i18next, i18next, Zustand, React Query, TypeScript

---

## Phase 1: Foundation Setup

### Task 1: Install Dependencies

**Files:**
- Modify: `package.json`

**Step 1: Install i18next packages**

```bash
pnpm add i18next react-i18next
```

Expected output: Successfully installed packages

**Step 2: Verify installation**

```bash
pnpm list i18next react-i18next
```

Expected: Both packages listed with versions

**Step 3: Commit**

```bash
git add package.json pnpm-lock.yaml
git commit -m "chore: add i18next and react-i18next dependencies"
```

---

### Task 2: Create Translation Files Structure

**Files:**
- Create: `src/i18n/locales/zh-TW.json`
- Create: `src/i18n/locales/en.json`

**Step 1: Create i18n directory structure**

```bash
mkdir -p src/i18n/locales
```

**Step 2: Create Traditional Chinese translation file**

Create `src/i18n/locales/zh-TW.json`:

```json
{
  "common": {
    "appName": "Movie Picker",
    "search": "搜尋電影...",
    "login": "登入",
    "logout": "登出",
    "user": "使用者",
    "menu": "選單"
  },
  "nav": {
    "home": "首頁",
    "top100": "Top 100",
    "random": "隨機挑片",
    "wishlist": "收藏清單"
  },
  "home": {
    "hero": {
      "title": "發現你的下一部經典電影",
      "subtitle": "從熱門大片到經典佳作，讓我們幫你找到完美的觀影選擇。智能推薦系統與隨機挑片功能，解決你的選擇困難。",
      "ctaRandom": "開始隨機挑片",
      "ctaTop100": "瀏覽 TOP 100"
    },
    "sections": {
      "trending": "本週趨勢",
      "popular": "熱門電影",
      "topRated": "高評分電影",
      "viewAll": "查看完整 TOP 100"
    }
  },
  "footer": {
    "tmdbDisclaimer": "本產品使用 TMDB API，但未經 TMDB 認可或認證。",
    "copyright": "Movie Picker"
  },
  "errors": {
    "loadFailed": "載入失敗，請稍後再試"
  }
}
```

**Step 3: Create English translation file**

Create `src/i18n/locales/en.json`:

```json
{
  "common": {
    "appName": "Movie Picker",
    "search": "Search movies...",
    "login": "Login",
    "logout": "Logout",
    "user": "User",
    "menu": "Menu"
  },
  "nav": {
    "home": "Home",
    "top100": "Top 100",
    "random": "Random Pick",
    "wishlist": "Wishlist"
  },
  "home": {
    "hero": {
      "title": "Discover Your Next Classic Movie",
      "subtitle": "From blockbusters to classics, let us help you find the perfect movie. Smart recommendations and random picks to solve your choice paralysis.",
      "ctaRandom": "Start Random Pick",
      "ctaTop100": "Browse TOP 100"
    },
    "sections": {
      "trending": "Trending This Week",
      "popular": "Popular Movies",
      "topRated": "Top Rated Movies",
      "viewAll": "View Full TOP 100"
    }
  },
  "footer": {
    "tmdbDisclaimer": "This product uses the TMDB API but is not endorsed or certified by TMDB.",
    "copyright": "Movie Picker"
  },
  "errors": {
    "loadFailed": "Failed to load, please try again later"
  }
}
```

**Step 4: Verify JSON syntax**

```bash
cat src/i18n/locales/zh-TW.json | jq . > /dev/null && echo "zh-TW.json is valid JSON"
cat src/i18n/locales/en.json | jq . > /dev/null && echo "en.json is valid JSON"
```

Expected: Both files are valid JSON

**Step 5: Commit**

```bash
git add src/i18n/locales/
git commit -m "feat(i18n): add Traditional Chinese and English translation files"
```

---

### Task 3: Create i18next Configuration

**Files:**
- Create: `src/i18n/config.ts`

**Step 1: Create i18next config file**

Create `src/i18n/config.ts`:

```typescript
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import zhTW from './locales/zh-TW.json'
import en from './locales/en.json'

i18n
  .use(initReactI18next)
  .init({
    resources: {
      'zh-TW': { translation: zhTW },
      'en': { translation: en }
    },
    lng: localStorage.getItem('language') || 'zh-TW',
    fallbackLng: 'zh-TW',
    interpolation: {
      escapeValue: false  // React already escapes values
    }
  })

export default i18n
```

**Step 2: Verify TypeScript compilation**

```bash
pnpm exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 3: Commit**

```bash
git add src/i18n/config.ts
git commit -m "feat(i18n): add i18next configuration"
```

---

## Phase 2: State Management

### Task 4: Create Language Store

**Files:**
- Create: `src/stores/languageStore.ts`

**Step 1: Create languageStore with Zustand**

Create `src/stores/languageStore.ts`:

```typescript
import { create } from 'zustand'
import i18n from '@/i18n/config'

export type Language = 'zh-TW' | 'en'

interface LanguageStore {
  language: Language
  setLanguage: (lang: Language) => void
}

export const useLanguageStore = create<LanguageStore>((set) => ({
  language: (localStorage.getItem('language') as Language) || 'zh-TW',

  setLanguage: (lang) => {
    set({ language: lang })
    localStorage.setItem('language', lang)
    i18n.changeLanguage(lang)
  }
}))
```

**Step 2: Verify TypeScript compilation**

```bash
pnpm exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 3: Commit**

```bash
git add src/stores/languageStore.ts
git commit -m "feat(i18n): add language store with Zustand"
```

---

## Phase 3: Provider Integration

### Task 5: Integrate I18nextProvider

**Files:**
- Modify: `src/app/providers.tsx`

**Step 1: Read current providers file**

```bash
cat src/app/providers.tsx
```

**Step 2: Add I18nextProvider to providers**

Modify `src/app/providers.tsx` - add import at top:

```typescript
import { I18nextProvider } from 'react-i18next'
import i18n from '@/i18n/config'
```

Then wrap the children with I18nextProvider (outermost wrapper):

```typescript
export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <I18nextProvider i18n={i18n}>
      <QueryClientProvider client={queryClient}>
        <Toaster />
        {children}
      </QueryClientProvider>
    </I18nextProvider>
  )
}
```

**Step 3: Verify TypeScript compilation**

```bash
pnpm exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 4: Test dev server starts**

```bash
pnpm dev
```

Expected: Server starts without errors (Ctrl+C to stop)

**Step 5: Commit**

```bash
git add src/app/providers.tsx
git commit -m "feat(i18n): integrate I18nextProvider in app providers"
```

---

## Phase 4: TMDB API Integration

### Task 6: Add Language Mapping Constants

**Files:**
- Modify: `src/utils/constants.ts`

**Step 1: Read current constants file**

```bash
cat src/utils/constants.ts
```

**Step 2: Add TMDB language mapping**

Add to `src/utils/constants.ts`:

```typescript
export const TMDB_LANGUAGE_MAP = {
  'zh-TW': 'zh-TW',
  'en': 'en-US'
} as const
```

**Step 3: Verify TypeScript compilation**

```bash
pnpm exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 4: Commit**

```bash
git add src/utils/constants.ts
git commit -m "feat(i18n): add TMDB language mapping constants"
```

---

### Task 7: Update useMovies Hook

**Files:**
- Modify: `src/hooks/useMovies.ts`

**Step 1: Read current useMovies hook**

```bash
cat src/hooks/useMovies.ts
```

**Step 2: Add language to queryKey**

Modify `src/hooks/useMovies.ts` - add imports at top:

```typescript
import { useLanguageStore } from '@/stores/languageStore'
import { TMDB_LANGUAGE_MAP } from '@/utils/constants'
```

Then modify the hook to include language in queryKey and pass to fetchMovies:

```typescript
export function useMovies(category: MovieCategory) {
  const language = useLanguageStore((state) => state.language)

  return useQuery({
    queryKey: ['movies', category, language],
    queryFn: () => fetchMovies(category, TMDB_LANGUAGE_MAP[language]),
    staleTime: 5 * 60 * 1000,
    keepPreviousData: true
  })
}
```

**Step 3: Verify TypeScript compilation**

```bash
pnpm exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 4: Commit**

```bash
git add src/hooks/useMovies.ts
git commit -m "feat(i18n): add language parameter to useMovies queryKey"
```

---

### Task 8: Update TMDB API Service

**Files:**
- Modify: `src/services/tmdb.ts`

**Step 1: Read current tmdb service**

```bash
cat src/services/tmdb.ts
```

**Step 2: Add language parameter to fetchMovies**

Modify the `fetchMovies` function signature to accept language parameter and pass it to API:

```typescript
export async function fetchMovies(
  category: MovieCategory,
  language: string = 'zh-TW'
) {
  const { data } = await axios.get(`${TMDB_BASE_URL}/movie/${category}`, {
    params: {
      api_key: TMDB_API_KEY,
      language: language,
      page: 1
    }
  })
  return data
}
```

**Step 3: Verify TypeScript compilation**

```bash
pnpm exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 4: Test API call works**

```bash
pnpm dev
```

Expected: App loads and shows movies (Ctrl+C to stop)

**Step 5: Commit**

```bash
git add src/services/tmdb.ts
git commit -m "feat(i18n): add language parameter to TMDB API calls"
```

---

## Phase 5: UI Components

### Task 9: Add Language Switcher to Header

**Files:**
- Modify: `src/components/layout/Header.tsx`

**Step 1: Read current Header component**

```bash
cat src/components/layout/Header.tsx
```

**Step 2: Add language switcher imports**

Add these imports to the top of `src/components/layout/Header.tsx`:

```typescript
import { Languages } from 'lucide-react'
import { useLanguageStore } from '@/stores/languageStore'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
```

**Step 3: Add language state to component**

Inside the Header component function, add:

```typescript
const { language, setLanguage } = useLanguageStore()
```

**Step 4: Add language switcher UI**

Add this before the mobile menu Sheet component (in the "右側操作" section):

```tsx
{/* 語言切換 */}
<DropdownMenu>
  <DropdownMenuTrigger asChild>
    <Button variant="ghost" size="sm">
      <Languages className="size-4" />
      <span className="hidden sm:inline">
        {language === 'zh-TW' ? '繁體中文' : 'English'}
      </span>
    </Button>
  </DropdownMenuTrigger>
  <DropdownMenuContent>
    <DropdownMenuItem onClick={() => setLanguage('zh-TW')}>
      繁體中文
    </DropdownMenuItem>
    <DropdownMenuItem onClick={() => setLanguage('en')}>
      English
    </DropdownMenuItem>
  </DropdownMenuContent>
</DropdownMenu>
```

**Step 5: Verify TypeScript compilation**

```bash
pnpm exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 6: Test language switcher appears**

```bash
pnpm dev
```

Expected: Language switcher button appears in header (Ctrl+C to stop)

**Step 7: Commit**

```bash
git add src/components/layout/Header.tsx
git commit -m "feat(i18n): add language switcher dropdown to Header"
```

---

## Phase 6: Component Translation

### Task 10: Translate Home Page

**Files:**
- Modify: `src/pages/Home.tsx`

**Step 1: Read current Home page**

```bash
cat src/pages/Home.tsx
```

**Step 2: Add useTranslation hook**

Add import at top of `src/pages/Home.tsx`:

```typescript
import { useTranslation } from 'react-i18next'
```

Add inside the Component function:

```typescript
const { t } = useTranslation()
```

**Step 3: Replace hardcoded text in hero section**

Replace the hero section text:

```tsx
{/* Main headline */}
<h1 className="text-5xl font-bold leading-none tracking-tighter text-foreground md:text-6xl lg:text-7xl xl:text-8xl">
  {t('home.hero.title').split('\n').map((line, i) => (
    <span key={i}>
      {line}
      {i < t('home.hero.title').split('\n').length - 1 && <br />}
    </span>
  ))}
</h1>

{/* Subtitle */}
<p className="max-w-2xl text-lg leading-relaxed text-muted-foreground md:text-xl">
  {t('home.hero.subtitle')}
</p>

{/* CTA Buttons */}
<div className="flex flex-wrap gap-6 pt-4">
  <Button size="lg" asChild>
    <Link to="/random">
      {t('home.hero.ctaRandom')}
      <ArrowRight className="size-5" />
    </Link>
  </Button>
  <Button size="lg" variant="ghost" asChild>
    <Link to="/top100">{t('home.hero.ctaTop100')}</Link>
  </Button>
</div>
```

**Step 4: Replace section titles**

Replace MovieSection titles:

```tsx
<MovieSection
  title={t('home.sections.trending')}
  movies={trending.data?.movies ?? []}
  isLoading={trending.isLoading}
  limit={12}
  sectionNumber="02"
/>

<MovieSection
  title={t('home.sections.popular')}
  movies={popular.data?.movies ?? []}
  isLoading={popular.isLoading}
  limit={12}
  sectionNumber="03"
/>

<MovieSection
  title={t('home.sections.topRated')}
  movies={topRated.data?.movies ?? []}
  isLoading={topRated.isLoading}
  limit={12}
  moreLink="/top100"
  moreLinkText={t('home.sections.viewAll')}
  sectionNumber="04"
/>
```

**Step 5: Verify TypeScript compilation**

```bash
pnpm exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 6: Test translations on Home page**

```bash
pnpm dev
```

Expected: Home page shows translations, can switch languages (Ctrl+C to stop)

**Step 7: Commit**

```bash
git add src/pages/Home.tsx
git commit -m "feat(i18n): translate Home page content"
```

---

### Task 11: Translate Header and Footer

**Files:**
- Modify: `src/components/layout/Header.tsx`
- Modify: `src/components/layout/Footer.tsx`

**Step 1: Translate Header navigation items**

Update `src/components/layout/Header.tsx` - add import:

```typescript
import { useTranslation } from 'react-i18next'
```

Add inside Header function:

```typescript
const { t } = useTranslation()
```

Update NAV_ITEMS constant to use translation keys:

```typescript
const NAV_ITEMS = [
  { label: t('nav.home'), href: ROUTES.HOME, icon: Film },
  { label: t('nav.top100'), href: '/top100', icon: TrendingUp },
  { label: t('nav.random'), href: '/random', icon: Dice5 },
  { label: t('nav.wishlist'), href: ROUTES.WISHLIST, icon: Heart },
]
```

Update search placeholder:

```tsx
<Input
  type="search"
  placeholder={t('common.search')}
  value={searchQuery}
  onChange={(e) => setSearchQuery(e.target.value)}
  className="pl-9"
/>
```

Update login/logout buttons:

```tsx
{isAuthenticated ? (
  <Button variant="ghost" size="sm" onClick={() => signOut()}>
    <User className="size-4" />
    <span className="hidden sm:inline">
      {user?.displayName ?? t('common.user')}
    </span>
  </Button>
) : (
  <Button variant="ghost" size="sm" onClick={() => signIn()}>
    <User className="size-4" />
    <span className="hidden sm:inline">{t('common.login')}</span>
  </Button>
)}
```

Update mobile menu:

```tsx
<span className="sr-only">{t('common.menu')}</span>
```

**Step 2: Translate Footer**

Update `src/components/layout/Footer.tsx` - add import:

```typescript
import { useTranslation } from 'react-i18next'
```

Add inside Footer function:

```typescript
const { t } = useTranslation()
```

Update footer text:

```tsx
<p className="text-muted-foreground text-sm">
  {t('footer.tmdbDisclaimer')}
</p>

<p className="text-muted-foreground text-xs">
  &copy; {new Date().getFullYear()} {t('footer.copyright')}
</p>
```

**Step 3: Verify TypeScript compilation**

```bash
pnpm exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 4: Test Header and Footer translations**

```bash
pnpm dev
```

Expected: Header navigation and Footer show translations (Ctrl+C to stop)

**Step 5: Commit**

```bash
git add src/components/layout/Header.tsx src/components/layout/Footer.tsx
git commit -m "feat(i18n): translate Header navigation and Footer content"
```

---

### Task 12: Add Remaining Translation Keys

**Files:**
- Modify: `src/i18n/locales/zh-TW.json`
- Modify: `src/i18n/locales/en.json`

**Step 1: Add more translation keys for other pages**

This task involves identifying all remaining hardcoded text in the app and adding translation keys. For now, we'll add commonly needed keys.

Update `src/i18n/locales/zh-TW.json` to add more keys:

```json
{
  "common": {
    "appName": "Movie Picker",
    "search": "搜尋電影...",
    "login": "登入",
    "logout": "登出",
    "user": "使用者",
    "menu": "選單",
    "loading": "載入中...",
    "noResults": "沒有找到結果"
  },
  "nav": {
    "home": "首頁",
    "top100": "Top 100",
    "random": "隨機挑片",
    "wishlist": "收藏清單"
  },
  "home": {
    "hero": {
      "title": "發現你的下一部經典電影",
      "subtitle": "從熱門大片到經典佳作，讓我們幫你找到完美的觀影選擇。智能推薦系統與隨機挑片功能，解決你的選擇困難。",
      "ctaRandom": "開始隨機挑片",
      "ctaTop100": "瀏覽 TOP 100"
    },
    "sections": {
      "trending": "本週趨勢",
      "popular": "熱門電影",
      "topRated": "高評分電影",
      "viewAll": "查看完整 TOP 100"
    }
  },
  "footer": {
    "tmdbDisclaimer": "本產品使用 TMDB API，但未經 TMDB 認可或認證。",
    "copyright": "Movie Picker"
  },
  "errors": {
    "loadFailed": "載入失敗，請稍後再試"
  }
}
```

Update `src/i18n/locales/en.json` similarly:

```json
{
  "common": {
    "appName": "Movie Picker",
    "search": "Search movies...",
    "login": "Login",
    "logout": "Logout",
    "user": "User",
    "menu": "Menu",
    "loading": "Loading...",
    "noResults": "No results found"
  },
  "nav": {
    "home": "Home",
    "top100": "Top 100",
    "random": "Random Pick",
    "wishlist": "Wishlist"
  },
  "home": {
    "hero": {
      "title": "Discover Your Next Classic Movie",
      "subtitle": "From blockbusters to classics, let us help you find the perfect movie. Smart recommendations and random picks to solve your choice paralysis.",
      "ctaRandom": "Start Random Pick",
      "ctaTop100": "Browse TOP 100"
    },
    "sections": {
      "trending": "Trending This Week",
      "popular": "Popular Movies",
      "topRated": "Top Rated Movies",
      "viewAll": "View Full TOP 100"
    }
  },
  "footer": {
    "tmdbDisclaimer": "This product uses the TMDB API but is not endorsed or certified by TMDB.",
    "copyright": "Movie Picker"
  },
  "errors": {
    "loadFailed": "Failed to load, please try again later"
  }
}
```

**Step 2: Verify JSON syntax**

```bash
cat src/i18n/locales/zh-TW.json | jq . > /dev/null && echo "zh-TW.json is valid"
cat src/i18n/locales/en.json | jq . > /dev/null && echo "en.json is valid"
```

Expected: Both files are valid JSON

**Step 3: Commit**

```bash
git add src/i18n/locales/
git commit -m "feat(i18n): add common translation keys for loading and errors"
```

---

## Phase 7: Testing & Verification

### Task 13: Manual Testing Checklist

**Files:**
- None (manual testing)

**Step 1: Start dev server**

```bash
pnpm dev
```

**Step 2: Test default language**

1. Open http://localhost:5173
2. Verify page loads in Traditional Chinese (zh-TW)
3. Check localStorage in DevTools: `localStorage.getItem('language')` should be `'zh-TW'`

**Step 3: Test language switching to English**

1. Click language switcher dropdown in Header
2. Select "English"
3. Verify:
   - Navigation items change to English (Home, Top 100, Random Pick, Wishlist)
   - Hero title changes to "Discover Your Next Classic Movie"
   - Section titles change to English
   - Footer text changes to English
4. Check localStorage: `localStorage.getItem('language')` should be `'en'`

**Step 4: Test language persistence**

1. Refresh the page (F5)
2. Verify language remains English
3. Click language switcher, select "繁體中文"
4. Refresh again
5. Verify language remains Traditional Chinese

**Step 5: Test movie data language switching**

1. Open Browser DevTools → Network tab
2. Filter by "movie"
3. Switch language to English
4. Check API requests - verify they include `language=en-US` parameter
5. Switch back to 繁中
6. Check API requests - verify they include `language=zh-TW` parameter

**Step 6: Note any issues**

Document any translation errors or missing translations for future fixes.

---

### Task 14: Update Design Document Status

**Files:**
- Modify: `docs/plans/2026-02-13-i18n-design.md`

**Step 1: Mark design as implemented**

Update the status in design document:

```markdown
**狀態：** 已實作
```

**Step 2: Commit**

```bash
git add docs/plans/2026-02-13-i18n-design.md
git commit -m "docs: mark i18n design as implemented"
```

---

## Verification Checklist

After completing all tasks, verify:

- ✅ i18next packages installed
- ✅ Translation files created (zh-TW.json, en.json)
- ✅ i18next configured with localStorage persistence
- ✅ languageStore created with Zustand
- ✅ I18nextProvider integrated in app
- ✅ TMDB_LANGUAGE_MAP constants added
- ✅ useMovies hook includes language in queryKey
- ✅ TMDB API service accepts language parameter
- ✅ Language switcher added to Header
- ✅ Home page fully translated
- ✅ Header navigation translated
- ✅ Footer translated
- ✅ Language switches between zh-TW and en
- ✅ Language preference persists after refresh
- ✅ Movie data fetches in correct language
- ✅ All TypeScript compilation passes
- ✅ No console errors in browser

## Next Steps

After implementing this plan:

1. **Translate remaining pages**: Top100, RandomPick, Wishlist, Search, NotFound
2. **Translate feature components**: MovieCard, MovieSection, FilterPanel, etc.
3. **Add unit tests**: Test languageStore and translation logic
4. **Optimize**: Consider lazy loading translation files if bundle size becomes concern
5. **Extend**: Add more languages if needed (e.g., zh-CN for Simplified Chinese)

## Notes

- Follow YAGNI: Only translate what's currently visible to users
- Keep translation keys organized by feature/page
- Ensure both language files have identical structure
- Test on different browsers to ensure localStorage works consistently
